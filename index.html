<!doctype html>
<html>
	<head>
		<title>Fast FFXIV Macro Builder</title>

		<link rel="stylesheet" type="text/css" href="css/materialize.min.css">
		<link rel="stylesheet" type="text/css" href="css/index.css">

		<script src = "js/materialize.min.js"></script>

	</head>
	<body>
		<div class="row">
			<div class="col s6">
				<div class="card blue-grey darken-1">
					<div class="card-content white-text">
						<span class="card-title">Abilities</span>
						<div class="input-field col s6">
							<input placeholder="Ability name" id="ability_search" type="text">
							<label for="ability_search">Search</label>
							<a class="waves-effect waves-light btn" id = "ability_search_clear">Clear</a>
						</div>
						<ul class="collection" id="ability-collection">

						</ul>
					</div>
				</div>
			</div>
			<div class="col s6">
				<div class="card blue-grey darken-1">
					<div class="card-content white-text">
						<span class="card-title">Macro output</span>
          				<textarea id="textarea1" class="materialize-textarea" ></textarea>
					</div>
				</div>
			</div>
		</div>

		<script>

			var abilityList = null;


			(function()
			{
				var request = new XMLHttpRequest();
				request.open('GET', './res/ability_structure.json', true);

				request.onload = function() 
				{
					if(request.status >= 200 && request.status < 400) 
					{
						var data = JSON.parse(request.responseText);

						abilityList = data;
						
						populateAbilities(data);
					} 
					else 
					{
						console.log('Status error');
					}
				};

				request.onerror = function() 
				{
					console.log('Error while fetching ability_structure.json');
				};

				request.send();
			})();

			function populateAbilities(data)
			{
				var $abiCollection = document.querySelector('#ability-collection');
				var $html = '';

				$abiCollection.innerHTML = '';

				for(var key in data)
				{
					if(!data.hasOwnProperty(key))
						continue;

					var ability = data[key];

					$html += '<li class="collection-item">';
					$html += '<img src="res/icon/' + ability.icon + '" alt="" class="ability_icon" data-ability="' + ability.id + '">';
					$html += '<span class="ability_name" data-ability="' + ability.id + '">' + ability.name + '</span>';
					$html += '</li>';
				}

				$abiCollection.innerHTML = $html;
			}
			


			var $abilitySearch = document.querySelector('#ability_search');

			$abilitySearch.addEventListener('input', function(e)
			{
				var searchText = $abilitySearch.value;

				if(searchText.length === 0)
					var filteredData = abilityList;
				else
					var filteredData = Object.values(abilityList).filter(x => x.id.indexOf(searchText.toLowerCase()) > -1);

				populateAbilities(filteredData)
			});
		</script>
	</body>
</html>